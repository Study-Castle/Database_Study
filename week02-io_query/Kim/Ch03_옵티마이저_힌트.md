## 3. ê¸°ë³¸ ë°ì´í„° ì²˜ë¦¬

### í’€ í…Œì´ë¸” ìŠ¤ìº”

![](./images/Untitled.webp)

- ì¸ë±ìŠ¤ë¥¼ í™œìš©í•˜ì§€ ì•Šê³  í…Œì´ë¸”ì„ ì²˜ìŒë¶€í„° ëê¹Œì§€ ì „ë¶€ ë‹¤ ë’¤ì ¸ì„œ ë°ì´í„°ë¥¼ ì°¾ëŠ” ë°©ì‹.

1. í…Œì´ë¸”ì˜ ë ˆì½”ë“œ ê±´ìˆ˜ê°€ ë§¤ìš° ì‘ì•„ ì¸ë±ìŠ¤ë¥¼ ìŠ¤ìº”í•˜ëŠ” ê²ƒë³´ë‹¤ í…Œì´ë¸” ìŠ¤ìº”ì´ ë” ë¹ ë¥¸ ê²½ìš°
2. whereì ˆì´ë‚˜ on ì ˆì— ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì¡°ê±´ì´ ì—†ëŠ” ê²½ìš°
3. ì˜µí‹°ë§ˆì´ì €ê°€ íŒë‹¨í•œ ì¡°ê±´ ì¼ì¹˜ ë ˆì½”ë“œ ê±´ìˆ˜ê°€ ë„ˆë¬´ ë§ì€ ê²½ìš°

---

### í’€ ì¸ë±ìŠ¤ ìŠ¤ìº”

![](<./images/Untitled%20(1).webp>)

- ì¸ë±ìŠ¤ í…Œì´ë¸”ì„ ì²˜ìŒë¶€í„° ëê¹Œì§€ ë‹¤ ë’¤ì ¸ì„œ ë°ì´í„°ë¥¼ ì°¾ëŠ” ë°©ì‹.
- í’€ ë°ì´í„° ìŠ¤ìº” ë°©ì‹ë³´ë‹¤ íš¨ìœ¨ì ì´ì§€ë§Œ, ì¸ë±ìŠ¤ í…Œì´ë¸” ì „ì²´ë¥¼ ì½ì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ì•„ì£¼ íš¨ìœ¨ì ì´ë¼ê³  í•  ìˆ˜ ì—†ìŒ.

---

### ODER BY

- ì •ë ¬ì„ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•
- |          | ì¥ì                                                                | ë‹¨ì                                                                              |
  | -------- | ------------------------------------------------------------------ | -------------------------------------------------------------------------------- |
  | ì¸ë±ìŠ¤   | ì´ë¯¸ ì¸ë±ìŠ¤ê°€ ì •ë ¬ë˜ì–´ ìˆì–´ ìˆœì„œëŒ€ë¡œ ì½ê¸°ë§Œ í•˜ë©´ ë˜ë¯€ë¡œ ë§¤ìš° ë¹ ë¦„. | ë¶€ê°€ì ì¸ ì¸ë±ìŠ¤ ì¶”ê°€/ì‚­ì œëŠ” ëŠë¦¬ë‹¤, ë””ìŠ¤í¬ ê³µê°„ì´ ë§ì´ í•„ìš”. ë©”ëª¨ë¦¬ê°€ ë§ì´ í•„ìš”. |
  | FileSort | ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•˜ì§€ ì•ŠëŠ” ë°©ë²•ìœ¼ë¡œ ì¸ë±ìŠ¤ë¥¼ ì´ìš©í•  ë•Œì˜ ë‹¨ì ì´ ì¥ì .  | ì •ë ¬ ì‘ì—… ì‹œ ì‹¤í–‰ ì‹œ ì²˜ë¦¬ë˜ë¯€ë¡œ ë ˆì½”ë“œì˜ ìˆ˜ê°€ ë§ì„ìˆ˜ë¡ ì„±ëŠ¥ ì €í•˜.                |

```sql
explain
WITH filtered AS (
    SELECT
        h.member_id,
        m.member_name,
        h.two_point_count,
        h.three_point_count
    FROM
        highlight AS h
            JOIN
        member AS m ON h.member_id = m.member_id
    WHERE
        m.is_aggregation_agreed = TRUE
      AND h.is_selected = TRUE
      AND h.created_at >= '2025-11-01 00:00:00'
      AND h.created_at <  '2025-11-01 00:00:00'
)
SELECT
    f.member_name,
    f.member_id,
    SUM(f.two_point_count * 2) AS two_total,
    SUM(f.three_point_count * 3) AS three_total,
    (SUM(f.two_point_count * 2) + SUM(f.three_point_count * 3)) AS total
FROM
    filtered AS f
GROUP BY
    f.member_name, f.member_id
ORDER BY
    total DESC,
    three_total DESC,
    two_total DESC
LIMIT 10;
```

- <ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©ì¤‘ì¸ ì¿¼ë¦¬ ì‹¤í–‰ê³„íš>
  ![](./images/ìŠ¤í¬ë¦°ìƒ·%202025-11-05%2010.13.51.png)

---

#### ì†ŒíŠ¸ ë²„í¼

- MySQLì´ ì •ë ¬ì„ ìˆ˜í–‰í•  ë•Œ ë³„ë„ì˜ ë©”ëª¨ë¦¬ ê³µê°„ì„ í• ë‹¹ë°›ì•„ì„œ ì‚¬ìš©í•˜ëŠ”ë°, ì´ ë©”ëª¨ë¦¬ ê³µê°„ì„ ì˜ë¯¸.
- ì¿¼ë¦¬ì˜ ì‹¤í–‰ì´ ì™„ë£Œë˜ë©´ ì¦‰ì‹œ ì‹œìŠ¤í…œìœ¼ë¡œ ë°˜ë‚©.
- ì •ë ¬í•  ë ˆì½”ë“œì˜ ìˆ˜ > ì†ŒíŠ¸ ë²„í¼ì˜ í¬ê¸°

1. ë©”ëª¨ë¦¬ì˜ ì†ŒíŠ¸ ë²„í¼ì—ì„œ ì •ë ¬ ìˆ˜í–‰(Multi-Merge)
2. ìˆ˜í–‰ Multi-Merge íšŸìˆ˜ëŠ” Sort_merge_passes ìƒíƒœ ë³€ìˆ˜ì— ëˆ„ì  ì§‘ê³„

- 8MB ì´ìƒë¶€í„°ëŠ” ì†ŒíŠ¸ ë²„í¼ í¬ê¸°ì— ë”°ë¥¸ ì„±ëŠ¥í–¥ìƒ ë³€í™” X
- MySQLì˜ ì†ŒíŠ¸ ë²„í¼ í¬ê¸°ëŠ” 56KB ~ 1MB ë¯¸ì•ˆì´ ì ì ˆ.
- ì†ŒíŠ¸ ë²„í¼ì˜ í¬ê¸°ë¥¼ í¬ê²Œ ì„¤ì • -> OOM ê°€ëŠ¥ì„±ê³¼ í•¨ê»˜ OOM-Killerê°€ ì—¬ìœ  ë©”ëª¨ë¦¬ í™•ë³´ë¥¼ ìœ„í•œ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ ìœ„í—˜ ì¡´ì¬.

#### ì •ë ¬ ì•Œê³ ë¦¬ì¦˜

###### ì‹±ê¸€ íŒ¨ìŠ¤

- ì†ŒíŠ¸ ë²„í¼ì— ì •ë ¬ ê¸°ì¤€ ì»¬ëŸ¼ì„ í¬í•¨í•´ **SELECT** ëŒ€ìƒì´ ë˜ëŠ” ì»¬ëŸ¼ì„ ì „ë¶€ ë‹´ì•„ ì •ë ¬ ìˆ˜í–‰.
- ì •ë ¬ì— í•„ìš”í•˜ì§€ ì•Šì€ ì»¬ëŸ¼ ë˜í•œ ì†ŒíŠ¸ ë²„í¼ì— ë‹´ì•„ ì •ë ¬
- ë‹¨ì  : ë§ì€ ì†ŒíŠ¸ ë²„í¼ ê³µê°„ í•„ìš”.

###### íˆ¬ íŒ¨ìŠ¤

- ì •ë ¬ ëŒ€ìƒ + PK ë§Œ ì†ŒíŠ¸ ë²„í¼ì— ë‹´ì•„ì„œ ì •ë ¬ ìˆ˜í–‰ -> ì •ë ¬ëœ ìˆœì„œëŒ€ë¡œ ë‹¤ì‹œ PKë¡œ í…Œì´ë¸”ì„ ì½ì–´ **SELECT**í•  ì»¬ëŸ¼ì„ ê°€ì ¸ì˜¤ëŠ” ë°©ì‹.
- ë‹¨ì  : í…Œì´ë¸”ì„ 2ë²ˆ ì½ìŒ.

> ìµœì‹  ë²„ì „ì—ì„œëŠ” ì‹±ê¸€ íŒ¨ìŠ¤ ì „ëµì„ ì‚¬ìš©. í•˜ì§€ë§Œ ì•„ë˜ì™€ ê°™ì€ ê²½ìš°ëŠ” íˆ¬ íŒ¨ìŠ¤ ì „ëµì„ ì‚¬ìš©í•œë‹¤.
>
> 1. ë ˆì½”ë“œì˜ í¬ê¸°ê°€ max_lenght_for_sort_data ì‹œìŠ¤í…œ ë³€ìˆ˜ì— ì„¤ì •ëœ ê°’ë³´ë‹¤ í° ê²½ìš°
> 2. BLOBë‚˜ TEXT íƒ€ì…ì˜ ì»¬ëŸ¼ì´ SELECT ëŒ€ìƒì— í¬í•¨ëœ ê²½ìš°

###### ì •ë ¬ ì²˜ë¦¬ ë°©ë²•

- ì„±ëŠ¥ : ì¸ë±ìŠ¤ ì •ë ¬ > ì¡°ì¸ì—ì„œ ë“œë¼ì´ë¹™ í…Œì´ë¸” ì •ë ¬ > ì¡°ì¸ì—ì„œ ì¡°ì¸ ê²°ê³¼ë¥¼ ì„ì‹œ í…Œì´ë¸”ë¡œ ì €ì¥ ì •ë ¬
- ì¸ë±ìŠ¤ ì‚¬ìš© ğŸ…¾ï¸ : FileSort ê³¼ì • ì—†ì´ ì¸ë±ìŠ¤ë¥¼ ìˆœì„œëŒ€ë¡œ ì½ì–´ ê²°ê³¼ ë°˜í™˜.
- ì¸ë±ìŠ¤ ì‚¬ìš© âŒ : ì •ë ¬ ë²„í¼ì— ì €ì¥í•˜ë©´ì„œ ì •ë ¬ì„ ì²˜ë¦¬.

- **ì¸ë±ìŠ¤ ì •ë ¬**
  - ì¡°ê±´
    1. ORDER BYì— ëª…ì‹œëœ ì»¬ëŸ¼ì´ ì œì¼ ë¨¼ì € ì½ëŠ” í…Œì´ë¸”ì— ì†í•´ì•¼í•¨.
    2. ORDER BY ìˆœì„œëŒ€ë¡œ ìƒì„±ëœ ì¸ë±ìŠ¤ê°€ ì¡´ì¬.
    3. WHEREì ˆì— ì²« ë²ˆì§¸ë¡œ ì½ëŠ” í…Œì´ë¸”ì˜ ì»¬ëŸ¼ì— ëŒ€í•œ ì¡°ê±´ == ORDER BY ì¸ë±ìŠ¤

```sql
SELECT *
FROM employees as e, salaries s
WHERE s.emp_no = e.emp_no
    AND e.emp_no BETWEEN 10 AND 20
ORDER BY e.emp_no;
```

- ì¡°ì¸ì˜ **ë“œë¼ì´ë¹™ í…Œì´ë¸”** ì •ë ¬
  - ë“œë¼ì´ë¹™ í…Œì´ë¸” : ì¡°ì¸ ì‹œ ë¨¼ì € ì—‘ì„¸ìŠ¤ë˜ëŠ” í…Œì´ë¸”
  - ì¡°ì¸ì„ ì‹¤í–‰í•˜ê¸° ì´ì „ì— ì¡°ì¸ ëŒ€ìƒì´ ë˜ëŠ” ì²« ë²ˆì¨° í…Œì´ë¸”ì˜ ë ˆì½”ë“œë¥¼ ìš°ì„  ì •ë ¬ -> ì¡°ì¸ ì‹¤í–‰

```sql
SELECT *
FROM employee as e, salaries as s
WHERE s.emp_no=e.emp_no
    AND e.emp_no BETWEEN 10 AND 20
ORDER BY e.last_name;
```

- employees í…Œì´ë¸” : ë“œë¼ì´ë¹™ í…Œì´ë¸”

- **ì„ì‹œ í…Œì´ë¸”** ì •ë ¬
  - 2ê°œ ì´ìƒì˜ í…Œì´ë¸”ì„ ì¡°ì¸í•˜ì§€ ì•ŠëŠ” ê²½ìš°ëŠ” ì„ì‹œ í…Œì´ë¸”ì„ ìƒì„±í•˜ì—¬ ì¡°ì¸ ê²°ê³¼ë¥¼ ì €ì¥ -> ì €ì¥ëœ í…Œì´ë¸” ì •ë ¬ ìˆ˜í–‰.

###### ì¿¼ë¦¬ ì²˜ë¦¬ ë°©ë²•

| ìŠ¤íŠ¸ë¦¬ë°                                  | ë²„í¼ë§                                                           |
| ----------------------------------------- | ---------------------------------------------------------------- |
| ë ˆì½”ë“œê°€ ê²€ìƒ‰ë  ë–„ë§ˆë‹¤ ë°”ë¡œ ì „ì†¡í•˜ëŠ” ë°©ì‹ | ë¨¼ì € ê²°ê³¼ë¥¼ ëª¨ì•„ MySQLì—ì„œ ê°€ê³µ í›„ ìŠ¤í† ë¦¬ì§€ ì—”ì§€ìœ¼ë¡œë¶€í„° ê°€ì ¸ì˜´. |
| GROUP BY / ORDER BY ì¿¼ë¦¬ì—ì„œëŠ” ë¶ˆê°€ëŠ¥     | LIMITë¥¼ ì‚¬ìš©í•´ë„ ì ˆê° íš¨ê³¼ X                                     |

---

### GROUP BY

- ìŠ¤íŠ¸ë¦¬ë° ì²˜ë¦¬ë¥¼ í•  ìˆ˜ ì—†ëŠ” ì²˜ë¦¬
- **GROUP BY**ì— ì‚¬ìš©ëœ ì¡°ê±´ì€ ì¸ë±ìŠ¤ ì‚¬ìš© ë¶ˆê°€ -> HAVINGì ˆì—ì„œ ì¸ë±ìŠ¤ë¥¼ ì´ìš©í•˜ëŠ” íŠœë‹ì€ ë¶ˆí•„ìš”.

##### GROUP BY ì‘ì—… ë°©ì‹

###### ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°

- **ì¸ë±ìŠ¤ ìŠ¤ìº”**(ì¸ë±ìŠ¤ë¥¼ ì°¨ë¡€ëŒ€ë¡œ ì½ëŠ” ë°©ë²•) : ì´ë¯¸ ì •ë ¬ëœ ì¸ë±ìŠ¤ë¥¼ ì½ëŠ” ê²ƒìœ¼ë¡œ ì¿¼ë¦¬ ì‹¤í–‰ ì‹œì ì— ì¶”ê°€ì ì¸ ì •ë ¬ ì‘ì—…ì´ë‚˜ ë‚´ë¶€ ì„ì‹œ í…Œì´ë¸”ì€ í•„ìš” âŒ
- **ë£¨ìŠ¤ ì¸ë±ìŠ¤ ìŠ¤ìº”**(ì¸ë±ìŠ¤ë¥¼ ê±´ë„ˆë›°ë©´ì„œ ì½ëŠ” ë°©ë²•)
  - ì‹¤í–‰ ê³„íšì˜ Extra ì»¬ëŸ¼ : _Using index for group-by_
  - ë‹¨ì¼ í…Œì´ë¸”ì— ëŒ€í•´ ìˆ˜í–‰ë˜ëŠ” GROUP BY ì²˜ë¦¬ì—ë§Œ ì‚¬ìš© ê°€ëŠ¥.
  - ì¸ë±ìŠ¤ì˜ ìœ ë‹ˆí¬í•œ ê°’ì˜ ìˆ˜ê°€ ì ì„ìˆ˜ë¡ ì„±ëŠ¥ í–¥ìƒ.
  - ì„ì‹œ í…Œì´ë¸” í•„ìš” âŒ

###### ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²½ìš°

- **ì„ì‹œ í…Œì´ë¸” ì‚¬ìš©**
  - ë‚´ë¶€ì ìœ¼ë¡œ GROUP BY ì ˆì˜ ì»¬ëŸ¼ë“¤ë¡œ êµ¬ì„±ëœ ìœ ë‹ˆí¬ ì¸ë±ìŠ¤ë¥¼ ê°€ì§„ ì„ì‹œ í…Œì´ë¸” ìƒì„± -> ì¤‘ë³µ ì œê±° ë° ì§‘í•© ì—°ì‚° ìˆ˜í–‰.

#### DISTINCT ì‘ì—… ë°©ì‹

- ì§‘ê³„ í•¨ìˆ˜ ğŸ‘Œ
  - ì£¼ì˜í•  ì ! : DISTINCTëŠ” SELECTí•˜ëŠ” ë ˆì½”ë“œë¥¼ ìœ ë‹ˆí¬í•˜ê²Œ SELECTí•˜ëŠ” ê²ƒì´ì§€, íŠ¹ì • ì»¬ëŸ¼ë§Œì„ ìœ ë‹ˆí¬í•˜ê²Œ ì¡°íšŒí•˜ëŠ” ê²ƒ âŒ
  - first_nameë§Œ ìœ ë‹ˆí¬í•œ ê²ƒì„ ê°€ì ¸ì˜¤ëŠ” ê²ƒì´ ì•„ë‹Œ **(first_name, last_name) ì¡°í•©**ì´ ìœ ë‹ˆí¬í•œ ë ˆì½”ë“œë¥¼ ê°€ì§€ê³  ì˜´.

```sql
SELECT DISTINCT first_name, last_name FROM employees;
```

```sql
SELECT DISTINCT(first_name), last_name FROM employees;
```
> DISTINCTëŠ” í•¨ìˆ˜ê°€ ì•„ë‹ˆë¼ì„œ ê´„í˜¸ëŠ” ì˜ë¯¸ê°€ ì—†ë‹¤. ë”°ë¼ì„œ, first_nameë§Œ ìœ ë‹ˆí¬í•œ ë ˆì½”ë“œë¥¼ ì¡°íšŒí•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ (fist_name,last_name)ì´ ìœ ë‹ˆí¬í•œ ë ˆì½”ë“œë¥¼ ì¡°íšŒ.




- ì§‘ê³„ í•¨ìˆ˜ ğŸ™…â€â™‚ï¸
    - í•¨ìˆ˜ì˜ ì¸ìë¡œ ì „ë‹¬ëœ ì»¬ëŸ¼ê°’ì´ ìœ ë‹ˆí¬í•œ ê²ƒë§Œ ê°€ì ¸ì˜´.


---

#### ê³ ê¸‰ ìµœì í™”
###### ì¸ë±ìŠ¤ í™•ì¥
```sql
CREATE TABLE dept_emp (
    emp_no INT NOT NULL,
    dept_no CHAR(4) NOT NULL,
    from_date DATE NOT NULL,
    to_date DATE NOT NULL,
    PRIMARY KEY (dept_no, emp_no),
    KEY ix_fromdate (from_date)
    ) ;
```
- PK : (dept_no, emp_no) / 2ë²ˆì§¸ KEY : from_date
- 2ë²ˆì§¸ ì¸ë±ìŠ¤ëŠ” ë°ì´í„° ë ˆì½”ë“œë¥¼ ì°¾ì•„ê°€ê¸° ìœ„í•´ PKì¸ dept_noì™€ emp_noë¥¼ ìˆœì„œëŒ€ë¡œ í¬í•¨.

###### ì¸ë±ìŠ¤ ë¨¸ì§€
- í•˜ë‚˜ì˜ í…Œì´ë¸”ì— ëŒ€í•´ 2ê°œ ì´ìƒì˜ ì¸ë±ìŠ¤ë¥¼ ì´ìš©í•´ ì¿¼ë¦¬ë¥¼ ì²˜ë¦¬.
- ì¡°ê±´ì´ ì—¬ëŸ¬ ê°œ ì¡´ì¬í•˜ë”ë¼ë„ í•˜ë‚˜ì˜ ì¸ë±ìŠ¤ì— í¬í•¨ëœ ì»¬ëŸ¼ì— ëŒ€í•œ ì¡°ê±´ë§Œìœ¼ë¡œ ì¸ë±ìŠ¤ ê²€ì‚¬->ë‚˜ë¨¸ì§€ ì¡°ê±´ì€ ì½ì–´ì˜¨ ë ˆì½”ë“œì— ëŒ€í•´ì„œëŠ” ì²´í¬ë§Œ ìˆ˜í–‰.

> Spring Bootì—ì„œì˜ ì¸ë±ìŠ¤ ë¨¸ì§€ ì‚¬ìš©
```java
@Getter
@Entity
@Builder(toBuilder = true)
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@AllArgsConstructor
@Table(name = "expend",indexes={
        @Index(name="idx_expend_date_user_id",columnList="expendDate, userId",unique=true)
})
public class Expend {
   // ì—”í‹°í‹° ë³€ìˆ˜
}

```
![](./images/ë‹¤ìš´ë¡œë“œ%20(12).png)
- <ì ìš©ëœ ëª¨ìŠµ>


- **ì‹¤í–‰ ê³„íš**
  - index_merge_intersection(êµì§‘í•©)
  - index_merge_sort_union(í•©ì§‘í•©)
  - index_merge_union(ì •ë ¬ í›„ í•©ì§‘í•©)