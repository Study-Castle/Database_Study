## ì£¼ì œ

ì¿¼ë¦¬ ì‹¤í–‰ ê³¼ì •, SQL, I/O

---

# [SQL ì‹¤í–‰ ê³¼ì •]

**: ì‚¬ìš©ì SQL ì‹¤í–‰ â†’ DB ì„œë²„ ë„ì°© â†’ SQL íŒŒì‹± â†’ SQL ìµœì í™” â†’ SQL ì‹¤í–‰ â†’ ê²°ê³¼ ë°˜í™˜**

![image](./images/Query_Flow.png)

## 1. ì‚¬ìš©ì SQL ì‘ì„± ë° ì‹¤í–‰ : Application Layer

```java
// Spring Boot + JPA 
String loginId = "user123";
String sql = "SELECT * FROM customer WHERE login_id = ?";

PreparedStatement ps = connection.prepareStatement(sql);
ps.setString(1, loginId);
ResultSet rs = ps.executeQuery();
```

- ë°”ì¸ë“œ ë³€ìˆ˜ vs ë¦¬í„°ëŸ´ : ìºì‹±ê³¼ SQL Injectionì—ì„œ ì°¨ì´ ë°œìƒ
1. **ë©”ëª¨ë¦¬ì— SQL ë¬¸ìì—´ ìƒì„±**, JDBC Driverê°€ DB ì—°ê²° ì¤€ë¹„ (Connection Poolì—ì„œ ê°€ì ¸ì˜´)
2. **JDBC Driver**ê°€ SQL íŒ¨í‚· ìƒì„±
    1. PreparedStatementì˜ ê²½ìš° SQL(â€ = ?â€)ê³¼ íŒŒë¼ë¯¸í„° ë¶„ë¦¬(â€user123â€)
    2. **ë„¤íŠ¸ì›Œí¬ë¡œ ì „ì†¡ (TCP/IP)**

## 2. DB ì„œë²„ ë„ì°©

- C**onnection Handler (ìŠ¤ë ˆë“œ í’€)**
    - ìƒˆë¡œìš´ ì»¤ë„¥ì…˜ ìš”ì²­ì´ ì˜¤ë©´ ìŠ¤ë ˆë“œ í’€ì—ì„œ ì›Œì»¤ ìŠ¤ë ˆë“œ í• ë‹¹ (ì¤‘ìš”í•œ ê±´ **Connection í• ë‹¹**)
    - í•´ë‹¹ ìŠ¤ë ˆë“œê°€ ì´ SQL ìš”ì²­ì„ ì²˜ë¦¬í•¨
- **ì¸ì¦ & ê¶Œí•œ ì²´í¬**
    - ì—°ê²°ëœ ì‚¬ìš©ìê°€ `customer` í…Œì´ë¸”ì— SELECT ê¶Œí•œì´ ìˆëŠ”ì§€ í™•ì¸
    - ê¶Œí•œì´ ì—†ìœ¼ë©´ ì—¬ê¸°ì„œ ì—ëŸ¬ ë°˜í™˜

## 3. SQL íŒŒì‹±

### **[íë¦„]**

- Lexer(Tokenizer, í† í°í™”) â†’ Parsing(Parser, Parse Tree) â†’ ë¬¸ë²• ê²€ì‚¬(Parser, Syntax Check) â†’ ì˜ë¯¸ ê²€ì‚¬(Parser, Semantic Check) / â†’ ë¼ì´ë¸ŒëŸ¬ë¦¬ ìºì‹œ í™•ì¸ â†’ Soft Parsing

### **SQL íŒŒì‹±** : ì‚¬ìš©ìë¡œë¶€í„° SQLì„ ì „ë‹¬ë°›ìœ¼ë©´ ê°€ì¥ ë©´ì € SQL Parserê°€ íŒŒì‹±ì„ ì§„í–‰í•¨

- íŒŒìŠ¤ íŠ¸ë¦¬ ìƒì„± : SQL ë¬¸ì„ ì´ë£¨ëŠ” ê°œë³„ êµ¬ì„±ìš”ì†Œë¥¼ ë¶„ì„í•´ì„œ íŒŒìŠ¤ íŠ¸ë¦¬ ìƒì„± (+ AST)

![image](./images/ParseTree.png)

- Syntax ì²´í¬ : **ë¬¸ë²•ì  ì˜¤ë¥˜**ê°€ ì—†ëŠ”ì§€ í™•ì¸. ex> ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” í‚¤ì›Œë“œ ì‚¬ìš©(SLCLET) ë“±
- semantic ì²´í¬ : **ì˜ë¯¸ìƒ ì˜¤ë¥˜**ê°€ ì—†ëŠ”ì§€ í™•ì¸. ex> ì¡´ì¬í•˜ì§€ ì•ŠëŠ” í…Œì´ë¸” í˜¹ì€ ì»¬ëŸ¼ ì‚¬ìš© ë“±
- Parserê°€ SQL ë¶„ì„ í›„ ìºì‹œ(Library Cache) í™•ì¸, ìºì‹œì— í•´ë‹¹ SQL ì¡´ì¬ ì—¬ë¶€ë¡œ ë‹¤ìŒ í–‰ë™ì´ ê²°ì •ë¨
    - **ì—¬ê¸°ì„œ ìºì‹œëŠ” â€œSQLâ€ì— ëŒ€í•œ ìºì‹œ (Not ë°ì´í„°)**

  ![image](./images/Cache.png)

    - ìºì‹œ íˆíŠ¸ â†’ Soft Parsing (SQL ìµœì í™” ì´í›„ ë‹¨ê³„ë¥¼ ìˆ˜í–‰í•˜ì§€ ì•Šê³ , ê²°ê³¼ë¥¼ ìºì‹œì—ì„œ ì°¾ì•„ê°)
    - ìºì‹œ ë¯¸ìŠ¤ â†’ Hard Parsing (SQL ìµœì í™” ì´í›„ ë‹¨ê³„ ìˆ˜í–‰)

## 4. SQL ìµœì í™”

### ê·œì¹™ ê¸°ë°˜ ì˜µí‹°ë§ˆì´ì € vs âœ…**ë¹„ìš© ê¸°ë°˜ ì˜µí‹°ë§ˆì´ì €**

- **SQL ìµœì í™”** : ì˜µí‹°ë§ˆì´ì €ëŠ” ë¯¸ë¦¬ ìˆ˜ì§‘í•œ ì‹œìŠ¤í…œ ë° ì˜¤ë¸Œì íŠ¸ í†µê³„ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë‹¤ì–‘í•œ ì‹¤í–‰ ê²½ë¡œë¥¼ ìƒì„±í•´ì„œ ë¹„êµí•œ í›„ ê°€ì¥ íš¨ìœ¨ì ì¸ í•˜ë‚˜ë¥¼ ì„ íƒí•¨
    - **ë¹„ìš© ë“±ì„ í™•ì¸**í•´ **ì‹¤í–‰ ê³„íš ìƒì„±** í›„ ì‹¤í–‰ ê°€ëŠ¥í•œ **ë¡œìš° ì†ŒìŠ¤ ìƒì„±**
    - ì´ ê³¼ì •ì—ì„œ ì¡°ì¸ ìˆœì„œ, ì¡°ì¸ ë°©ë²•, ì‚¬ìš© ì¸ë±ìŠ¤, ìŠ¤ìº” ë°©ì‹, ì§‘ê³„ ë°©ì‹ ë“± ê³ ë¯¼
        - í…Œì´ë¸” 5ê°œ ì¡°ì¸ë§Œ í•´ë„ 5!, ì–´ë–¤ ì¸ë±ìŠ¤ ì‚¬ìš©í• ì§€, ì–´ë–»ê²Œ ìŠ¤ìº”í• ì§€ .. ë“± ë§ì€ ì‹œê°„ì´ ì†Œìš”ë¨
- ì˜µí‹°ë§ˆì´ì €ê°€ **í†µê³„ ì •ë³´ ìˆ˜ì§‘**
    - í…Œì´ë¸”, ì¸ë±ìŠ¤ í†µê³„ ë° ì»¬ëŸ¼ ë¶„í¬ë„, íˆìŠ¤í† ê·¸ë¨ ë“±
- ì‹¤í–‰ ê³„íš í›„ë³´ ìƒì„± í›„ ë¹„ìš© ê³„ì‚°
    - Disk I/O, CPU ë“±ì˜ ë¹„ìš©ì„ í†µê³„ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê³„ì‚°
- **ë¡œìš° ì†ŒìŠ¤ ìƒì„±** (ì‹¤í–‰ ê³„íšì˜ ì‹¤í–‰ ê°€ëŠ¥í•œ ì„¸ë¶€ êµ¬í˜„) : SQL ì˜µí‹°ë§ˆì´ì €ê°€ ì„ íƒí•œ ì‹¤í–‰ ê²½ë¡œë¥¼ ì‹¤ì œ ì‹¤í–‰ ê°€ëŠ¥í•œ ì½”ë“œ ë˜ëŠ” í”„ë¡œì‹œì € í˜•íƒœë¡œ í¬ë§·íŒ… í•˜ëŠ” ë‹¨ê³„. ë¡œìš° ì†ŒìŠ¤ ìƒì„±ê¸°ê°€ ì§„í–‰í•¨
    - ë¡œìš° ì†ŒìŠ¤?

        ```jsx
        Sort (ORDER BY e.SAL DESC)
        â””â”€ Nested Loop Join
           â”œâ”€ Table Access Full (DEPT)
           â””â”€ Table Access By Index Rowid (EMP)
                â””â”€ Index Range Scan (IDX_EMP_SAL)
        ```

      ì—¬ê¸°ì„œ **ê° ì¤„ì˜ ì‹¤í–‰ ê°€ëŠ¥í•œ ì½”ë“œê°€ Row Source**

        - `Index Range Scan`
        - `Table Access By Index Rowid`
        - `Nested Loop Join`
        - `Sort`

      ì´ëŸ° ê°ê°ì´ **ë¡œìš°ë¥¼ ë§Œë“¤ì–´ì„œ ìœ„ë¡œ ë„˜ê²¨ì£¼ëŠ” í•¨ìˆ˜ ë‹¨ìœ„(ëª¨ë“ˆ)**ì„

- ë¼ì´ë¸ŒëŸ¬ë¦¬ ìºì‹œì— ì €ì¥
    - SQL í…ìŠ¤íŠ¸ ì›ë³¸, íŒŒìŠ¤ íŠ¸ë¦¬, ì‹¤í–‰ ê³„íš, ë¡œìš° ì†ŒìŠ¤ ì½”ë“œ(Template)
        - Row Source Template â†’ Library Cache (SGA) (ìµœì í™” ì‹œì  ìºì‹œ ì ì¬, ì‹¤í–‰ ê°€ëŠ¥í•œ êµ¬ì¡°ì²´)

            ```java
            // ë¼ì´ë¸ŒëŸ¬ë¦¬ ìºì‹œì— ì €ì¥
            struct row_source_template {
                // 1. ì–´ë–¤ ì—°ì‚°ì¸ì§€
                operation_type: INDEX_RANGE_SCAN
                
                // 2. ì–´ë–¤ ê°ì²´ë¥¼ ì‚¬ìš©í•˜ëŠ”ì§€
                object_name: "idx_customer_id"
                
                // 3. ì–´ë–¤ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí• ì§€
                open_function: &index_scan_open      // í•¨ìˆ˜ í¬ì¸í„°
                fetch_function: &index_scan_fetch    // í•¨ìˆ˜ í¬ì¸í„°
                close_function: &index_scan_close    // í•¨ìˆ˜ í¬ì¸í„°
                
                // 4. ìì‹ ë…¸ë“œ (íŠ¸ë¦¬ êµ¬ì¡°)
                children: [...]
            }
            ```

        - Row Source Instance â†’ PGA (ì‹¤í–‰ ì‹œì )

            ```java
            // PGAì—ë§Œ ì¡´ì¬ (ì‹¤í–‰ ì¤‘)
            struct row_source_instance {
                template: â†’ ë¼ì´ë¸ŒëŸ¬ë¦¬ ìºì‹œ ì°¸ì¡°
                
                // ì‹¤í–‰ ì¤‘ ìƒíƒœ (ë¼ì´ë¸ŒëŸ¬ë¦¬ ìºì‹œì— ì—†ìŒ!)
                current_position: 150      // í˜„ì¬ ìœ„ì¹˜
                rows_fetched: 10          // ì½ì€ í–‰ ìˆ˜
                temp_buffer: [...]        // ì„ì‹œ ë²„í¼
                bind_values: [123]        // ë°”ì¸ë“œ ë³€ìˆ˜ ê°’
            }
            ```

    - **ì†Œí”„íŠ¸ íŒŒì‹± vs í•˜ë“œ íŒŒì‹±** (íŒŒì‹±ì´ì§€ë§Œ ì˜µí‹°ë§ˆì´ì €ì˜ ìµœì í™” ë‹¨ê³„ê¹Œì§€ í¬í•¨)
      
      ![image](./images/Hard_Soft_Parsing.png)

        - ë¼ì´ë¸ŒëŸ¬ë¦¬ ìºì‹œì— ìµœì´ˆ 1íšŒ ë“±ë¡, ê·¸ í›„ SQLë¬¸ ìì²´ë¥¼ í‚¤ë¡œ ìºì‹œ í™•ì¸
        - **í•˜ë“œ íŒŒì‹±**ì€ **ìµœì í™” ë° ë¡œìš° ì†ŒìŠ¤ ìƒì„± ê³¼ì •**ì„ ê±°ì¹˜ê¸° ë•Œë¬¸ì— CPU ì‚¬ìš©ì´ ë†’ì€ ì‘ì—…ì„
        - ë°˜ë©´, **ì†Œí”„íŠ¸ íŒŒì‹±**ì€ ìºì‹œì— ìˆë‹¤ë©´ ìµœì í™” ë° ë¡œìš° ì†ŒìŠ¤ ìƒì„± ê³¼ì •ì„ ê±°ì¹˜ì§€ ì•ŠìŒ
        - ë”°ë¼ì„œ í•˜ë“œ íŒŒì‹±ì„ ì¤„ì´ëŠ” ê²ƒì´ ì¤‘ìš”í•¨. ì´ë¥¼ ìœ„í•´ **â€˜ë°”ì¸ë“œ ë³€ìˆ˜â€™**ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
            - SQL ë¬¸ ìì²´ í…ìŠ¤íŠ¸ë¥¼ ìºì‹œì˜ í‚¤ë¡œ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— í•œ ê¸€ìë§Œ ë‹¬ë¼ì ¸ë„ ë‹¤ì‹œ í•˜ë“œ íŒŒì‹± ê³¼ì •ì„ ê±°ì³ ìºì‹œì— ì ì¬í•¨
            - ë‹¨ê¸°ê°„ì— ë§ì€ ìš”ì²­ì´ ëª°ë¦¬ëŠ” ê²½ìš°, ìºì‹œê°€ ë¶€ì¡±í•´ì ¸ì„œ ìºì‹œë¥¼ ì‚­ì œí•˜ê³ , ë˜ ë˜‘ê°™ì€ ì¿¼ë¦¬ë¥¼ ì ì¬í•˜ëŠ” ì¼ì´ ë¹ˆë²ˆí•˜ê²Œ ë°œìƒí•˜ë¯€ë¡œ ì†ë„ê°€ ë§ì´ ì €í•˜ë  ìˆ˜ ìˆìŒ
            - **ë°”ì¸ë“œ ë³€ìˆ˜**ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì€ í”„ë¡œì‹œì €ì²˜ëŸ¼ íŒŒë¼ë¯¸í„° Driven ë°©ì‹ìœ¼ë¡œ SQLì„ ì‘ì„±í•¨
                - ex. `â€œSELECT * FROM CUSTOMET WHERE LOGIN_ID = ?â€`
                - vs `â€œSELECT * FROM CUSTOMET WHERE LOGIN_ID = HELLOâ€`
                    - í›„ìì˜ ë°©ë²•ì€ ê°ê°ì˜ idê¹Œì§€ ì™„ë²½íˆ ê°™ì•„ì•¼ ìºì‹œ íˆíŠ¸ê°€ ë¨
                - ì´ SQLì— ëŒ€í•œ í•˜ë“œ íŒŒì‹±ì€ ìµœì´ˆ í•œ ë²ˆë§Œ ì¼ì–´ë‚˜ê³ , ìºì‹±ëœ SQLì„ ì‚¬ìš©ì(í”„ë¡œì„¸ìŠ¤)ê°€ ê³µìœ í•˜ë©´ì„œ ì‚¬ìš©í•¨

## 5. SQL ì‹¤í–‰

- ì‹¤í–‰ ì—”ì§„ (Executor)
    - ë°”ì¸ë“œ ë³€ìˆ˜ ë°”ì¸ë”©, ì‹¤í–‰ ê³„íšì— ë”°ë¼ ì‹¤í–‰
- (ì¸ë±ìŠ¤) ìŠ¤ìº” ì‹œì‘
    - ì¸ë±ìŠ¤ ìŠ¤ìº” ì‹œ **ë²„í¼ ìºì‹œë¥¼ ê¸°ì¤€**ìœ¼ë¡œ í•œ **ë¬¼ë¦¬ì , ë…¼ë¦¬ì  I/O ë°œìƒ ê³¼ì •** ì˜ˆì‹œ (í´ë¡œë“œ ã„³)

        ```
        ## 6ï¸âƒ£ SQL ì‹¤í–‰ (Execution)
        
        ### 6-1. ì‹¤í–‰ ì—”ì§„(Executor) ì‹œì‘
        
        **ë°”ì¸ë“œ ë³€ìˆ˜ ë°”ì¸ë”©:**
        ```
      Bind Variable :1 â†’ 'user123'
        ```
        
        ---
        
        ### 6-2. ì¸ë±ìŠ¤ ìŠ¤ìº” ì‹œì‘
        
        **Step 1: ì¸ë±ìŠ¤ ë£¨íŠ¸ ë¸”ë¡ ì½ê¸°**
        ```
      ìš”ì²­: "idx_login_id ì¸ë±ìŠ¤ì˜ ë£¨íŠ¸ ë¸”ë¡ì„ ì½ì–´ì¤˜"
        ```
        
        **â‘  ë²„í¼ ìºì‹œ í™•ì¸**
        ```
      [Buffer Cache ì¡°íšŒ]
      ê²€ìƒ‰: tablespace_id=1, block_id=1000 (ë£¨íŠ¸ ë¸”ë¡)
      ê²°ê³¼: MISS (ìºì‹œì— ì—†ìŒ)
      â‘¡ ë¬¼ë¦¬ì  I/O ë°œìƒ
      c// ì‹¤í–‰ ì—”ì§„ì´ ì‹œìŠ¤í…œ ì½œ í˜¸ì¶œ
      read(fd, buffer, 16KB, offset=1000*16KB)
        ```
        
        **ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­:**
        ```
      [User Mode] DB í”„ë¡œì„¸ìŠ¤
      â†“ read() ì‹œìŠ¤í…œ ì½œ
      [Kernel Mode] ìš´ì˜ì²´ì œ
      â†“ ë””ìŠ¤í¬ I/O ìš”ì²­
      [í”„ë¡œì„¸ìŠ¤ ìƒíƒœ ë³€ê²½]
      Running â†’ Waiting (I/O ëŒ€ê¸° í)
        ```
        
        **ë””ìŠ¤í¬ ì»¨íŠ¸ë¡¤ëŸ¬ ì‘ì—…:**
        ```
        1. ë””ìŠ¤í¬ í—¤ë“œ ì´ë™ (Seek Time: ~5ms, HDD ê¸°ì¤€)
        2. ë””ìŠ¤í¬ íšŒì „ ëŒ€ê¸° (Rotational Latency: ~3ms)
        3. ë°ì´í„° ì½ê¸° (Transfer Time: ~0.1ms)
        4. ì»¤ë„ ë²„í¼ì— ë³µì‚¬
        ```
        
        **ì¸í„°ëŸ½íŠ¸ ë°œìƒ:**
        ```
      ë””ìŠ¤í¬: "I/O ì™„ë£Œ!" (ì¸í„°ëŸ½íŠ¸ ì‹ í˜¸)
      â†“
      ì»¤ë„: í”„ë¡œì„¸ìŠ¤ë¥¼ Waiting â†’ Ready íë¡œ ì´ë™
      â†“
      ìŠ¤ì¼€ì¤„ëŸ¬: Ready íì—ì„œ í”„ë¡œì„¸ìŠ¤ ì„ íƒ
      â†“
      í”„ë¡œì„¸ìŠ¤ ì¬ê°œ: Running ìƒíƒœë¡œ ë³µê·€
        ```
        
        **ë²„í¼ ìºì‹œì— ì ì¬:**
        ```
      [Buffer Cacheì— ì¶”ê°€]
      Key: (tablespace=1, block=1000)
      Value: [16KB ì¸ë±ìŠ¤ ë£¨íŠ¸ ë¸”ë¡ ë°ì´í„°]
      LRU ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€ (Most Recently Used)
        ```
        
        **ë…¼ë¦¬ì  I/O ì¹´ìš´íŠ¸: 1**
        
        ---
        
        **Step 2: ì¸ë±ìŠ¤ ë£¨íŠ¸ ë¸”ë¡ì—ì„œ ê²€ìƒ‰**
        ```
      [ì¸ë±ìŠ¤ ë£¨íŠ¸ ë¸”ë¡ ë‚´ìš©]
      â”œâ”€ 'aaa' ~ 'mmm' â†’ Branch Block #2001
      â”œâ”€ 'nnn' ~ 'zzz' â†’ Branch Block #2002
        ```
        
        `'user123'`ì€ `'nnn' ~ 'zzz'` ë²”ìœ„ â†’ **Branch Block #2002**ë¡œ ì´ë™
        
        ---
        
        **Step 3: ì¸ë±ìŠ¤ ë¸Œëœì¹˜ ë¸”ë¡ ì½ê¸°**
        ```
      [Buffer Cache ì¡°íšŒ]
      ê²€ìƒ‰: block_id=2002
      ê²°ê³¼: MISS â†’ ë¬¼ë¦¬ì  I/O ë°œìƒ (ìœ„ì™€ ë™ì¼í•œ ê³¼ì •)
        ```
        
        **ë…¼ë¦¬ì  I/O ì¹´ìš´íŠ¸: 2**
        ```
      [ì¸ë±ìŠ¤ ë¸Œëœì¹˜ ë¸”ë¡ ë‚´ìš©]
      â”œâ”€ 'nnn' ~ 'rrr' â†’ Leaf Block #5001
      â”œâ”€ 'sss' ~ 'vvv' â†’ Leaf Block #5002
      â”œâ”€ 'www' ~ 'zzz' â†’ Leaf Block #5003
        ```
        
        `'user123'`ì€ `'sss' ~ 'vvv'` ë²”ìœ„ â†’ **Leaf Block #5002**ë¡œ ì´ë™
        
        ---
        
        **Step 4: ì¸ë±ìŠ¤ ë¦¬í”„ ë¸”ë¡ ì½ê¸°**
        ```
      [Buffer Cache ì¡°íšŒ]
      ê²€ìƒ‰: block_id=5002
      ê²°ê³¼: HIT! (ì´ë¯¸ ìºì‹œì— ìˆìŒ, ì´ì „ ì¿¼ë¦¬ê°€ ì½ì–´ë‘ )
        ```
        
        **ë…¼ë¦¬ì  I/O ì¹´ìš´íŠ¸: 3** (ë¬¼ë¦¬ì  I/OëŠ” 0)
        ```
      [ì¸ë±ìŠ¤ ë¦¬í”„ ë¸”ë¡ ë‚´ìš©]
      login_id    | ROWID
      ------------+-----------------
      'user100'   | 0x000A1234
      'user123'   | 0x000A5678  â† ì°¾ìŒ!
      'user200'   | 0x000A9ABC
        ```
        
        **ROWID íšë“: `0x000A5678`**
        
        ---
        
        ### 6-3. í…Œì´ë¸” ë¸”ë¡ ì½ê¸° (Table Access By Rowid)
        
        **Step 5: ROWIDë¡œ í…Œì´ë¸” ë¸”ë¡ ì ‘ê·¼**
        ```
      ROWID 0x000A5678 ë¶„ì„:
      â”œâ”€ ë°ì´í„°íŒŒì¼ ë²ˆí˜¸: 10
      â”œâ”€ ë¸”ë¡ ë²ˆí˜¸: 22136 (0x5678)
      â””â”€ ìŠ¬ë¡¯ ë²ˆí˜¸: 5
        ```
        ```
      [Buffer Cache ì¡°íšŒ]
      ê²€ìƒ‰: datafile=10, block=22136
      ê²°ê³¼: MISS â†’ ë¬¼ë¦¬ì  I/O ë°œìƒ
        ```
        
        **ë…¼ë¦¬ì  I/O ì¹´ìš´íŠ¸: 4**
        ```
      [í…Œì´ë¸” ë¸”ë¡ ë‚´ìš© - Block #22136]
      Slot  | Data
      ------+--------------------------------
      0   | customer_id=100, name='Alice', ...
      ...
      5   | customer_id=123, login_id='user123', name='Bob', email='bob@example.com', ...  â† ì°¾ìŒ!
      ...
        ```
        
        ---
        
        ### 6-4. ê²°ê³¼ ìƒì„±
        
        **ì‹¤í–‰ ì—”ì§„ì´ ê²°ê³¼ ë ˆì½”ë“œ ìƒì„±:**
        ```
      ResultSet:
      {
      customer_id: 123,
      login_id: 'user123',
      name: 'Bob',
      email: 'bob@example.com',
      created_at: '2024-01-15 10:30:00'
      }
        ```
        
        ---
        ```

    - **ë°ì´í„° ê°€ì ¸ì˜¤ê¸°**
        - ë²„í¼ ìºì‹œ í™•ì¸ (ë°ì´í„° ë¸”ë¡ ì¡´ì¬ ì—¬ë¶€)

          ![image](./images/Cache.png)

            - **ì—¬ê¸°ì„œ ìºì‹œëŠ” â€œë°ì´í„° ë¸”ë¡â€ì— ëŒ€í•œ ìºì‹œ**
        - ìºì‹œì— ë°ì´í„° ë¸”ë¡ ì¡´ì¬ ì‹œ, ë…¼ë¦¬ì  I/Oë¡œ, ì‹œìŠ¤í…œ ì½œ X
        - ìºì‹œì— ë°ì´í„° ë¸”ë¡ ì¡´ì¬í•˜ì§€ ì•Šì„ ì‹œ, ë¬¼ë¦¬ì  I/Oë¡œ, ì‹œìŠ¤í…œ ì½œ O
            - ì´ ë˜í•œ Diskì—ì„œ ì½ì€ ë°ì´í„° ë¸”ë¡ì„ ìºì‹œì— ì €ì¥í•˜ëŠ” ê³¼ì •ì„ ê±°ì¹˜ë¯€ë¡œ ì´ ê³¼ì •ì— ë…¼ë¦¬ì  I/Oë„ í•´ë‹¹ë¨
            - ì‹œìŠ¤í…œ ì½œ â†’ Disk I/O ìš”ì²­ â†’ í”„ë¡œì„¸ìŠ¤ ìƒíƒœ ë³€ê²½ (Running â†’ Waiting(I/O ëŒ€ê¸° í)) ë° ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­
            - Disk I/O ì™„ë£Œ(ì¸í„°ëŸ½íŠ¸) â†’ í”„ë¡œì„¸ìŠ¤ ìƒíƒœ ë³€ê²½ (Waiting â†’ Ready í) â†’ ìŠ¤ì¼€ì¤„ë§ ë””ìŠ¤íŒ¨ì¹˜

              ![image](./images/Logical_Physical_IO.png)

- ì‹¤í–‰ ì—”ì§„ì´ ê²°ê³¼ ë ˆì½”ë“œ ìƒì„±

## 6. ê²°ê³¼ ë°˜í™˜

- DB ì„œë²„ê°€ ê²°ê³¼ íŒ¨í‚· ìƒì„±
- ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ë¡œ ì „ì†¡
- JDBC Driverê°€ ê²°ê³¼ íŒŒì‹±
- ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‚¬ìš©

# [SQL]

## SQLì´ ëŠë¦° ì´ìœ 

: Disk I/O ë•Œë¬¸ !

### í”„ë¡œì„¸ìŠ¤ ìƒëª… ì£¼ê¸°

- new â†’ ( ready - running - waiting ) â†’ terminated

![image](./images/Process_LifeCycle.png)

- CPUë¥¼ ì‚¬ìš©í•˜ë©° ì‘ì—…í•´ì•¼ í•˜ëŠ”ë°, I/O ì¸í„°ëŸ½íŠ¸ë¡œ ì¸í•´ ëŒ€ê¸° ë° ì¤€ë¹„ ìƒíƒœë¡œ ë³€ê²½ë˜ë©° í•  ì¼ì„ í•˜ì§€ ëª»í•˜ëŠ” ê²ƒì´ ê°€ì¥ í° ë¬¸ì œ
    - **CPU ì‘ì—… (Compute)**: ì¿¼ë¦¬ íŒŒì‹±, ìµœì í™”, ì •ë ¬, ì¡°ì¸ ë“±
    - **I/O ì‘ì—… (Disk/Network)**: í…Œì´ë¸” ë°ì´í„°, ì¸ë±ìŠ¤, ë¡œê·¸ íŒŒì¼ ì½ê¸°/ì“°ê¸°
        - `â€œë””ìŠ¤í¬ì•¼ ì´ Block ì½ì–´ì¤˜â€` : ì§ì ‘ ì½ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ OS ì»¤ë„ì—ê²Œ ì‹œìŠ¤í…œ ì½œ(read(), pread())ë¥¼ ë‚ ë¦¬ê³  (ì‹¤í–‰ ìƒíƒœì—ì„œ) ëŒ€ê¸° ìƒíƒœë¡œ ì „í™˜ë¨
        - **í”„ë¡œì„¸ìŠ¤ ëŒ€ê¸° íë¦„ (I/O Interrupt)**
            1. DB ì—”ì§„ì´ read() ì‹œìŠ¤í…œ ì½œ í˜¸ì¶œ
            2. **ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­** ë°œìƒ (User Mode â†’ Kernel Mode)
            3. ì»¤ë„ì´ ë””ìŠ¤í¬ ì»¨íŠ¸ë¡¤ëŸ¬ì— I/O ìš”ì²­
            4. í”„ë¡œì„¸ìŠ¤ëŠ” **Waiting** íë¡œ ì´ë™
            5. ë””ìŠ¤í¬ê°€ ì¸í„°ëŸ½íŠ¸ë¡œ ì™„ë£Œ ì‹ í˜¸
            6. ì»¤ë„ì´ í”„ë¡œì„¸ìŠ¤ë¥¼ **ready** íë¡œ ì´ë™
            7. ë‹¤ì‹œ **ìŠ¤ì¼€ì¤„ë§**ë˜ì–´ **ì‹¤í–‰**
- ê²°êµ­ ë™ê¸°/Blocking ë•Œë¬¸ì— **IO ì‘ì—… ë™ì•ˆ CPUë¥¼ ì‚¬ìš©í•˜ì§€ ëª»í•˜ê¸° ë•Œë¬¸**
    - ê·¸ëŸ¼ ë¹„ë™ê¸°ë¡œ í•˜ë©´ ë˜ì§€ ì•Šë‚˜?
        - DBëŠ” ì •í•©ì„±(ì¼ê´€ì„±)ì´ ë§¤ìš° ì¤‘ìš”í•œë°, ë¹„ë™ê¸° ë°©ì‹ì€ ì´ë¥¼ ë§Œì¡±ì‹œí‚¤ê¸°ê°€ ì–´ë ¤ì›€
        - ê·¸ëŸ¼ì—ë„ ì¼ë¶€ì—ì„œ ì‚¬ìš© ì¤‘ (ë¹„ë™ê¸° IO)
            - Read Ahead (í”„ë¦¬í˜ì¹˜) : ìˆœì°¨ ìŠ¤ìº” ì‹œ ë‹¤ìŒ ë¸”ë¡ ë¯¸ë¦¬ ì½ê¸°(ë¹„ë™ê¸°)
            - Background Flush / Checkpoint : ë²„í¼í’€ Dirty Page ë¹„ë™ê¸° ì“°ê¸°
- **ê°œì„  ë°©ë²•**
    1. (Disk) I/O ì¤„ì´ê¸° (ìºì‹œ(ë²„í¼), ë©”ëª¨ë¦¬, ë°°ì¹˜)
    2. I/O ì†ë„ ë¹ ë¥´ê²Œ í•˜ê¸°
        1. **ê²€ìƒ‰ ë²”ìœ„ ì¤„ì´ê¸° (ì¸ë±ìŠ¤ë¡œ ì ‘ê·¼)**
        2. ìˆœì°¨ ì ‘ê·¼í•˜ê¸°

## ë°ì´í„° ì €ì¥ êµ¬ì¡°

![image](./images/Data_Store_Structure.png)

- Disk File â†’ Tablespace â†’ Segment â†’ Extent â†’ Block

### **Datafile** : ë””ìŠ¤í¬ ìƒì˜ ë¬¼ë¦¬ì ì¸ OS íŒŒì¼ (.ibd â€¦)

- ëª¨ë“  ë°ì´í„°ëŠ” ê²°êµ­ ì´ íŒŒì¼ ì•ˆì˜ ë°”ì´íŠ¸ë¡œ ì €ì¥ë¨
- DB ìŠ¤í† ë¦¬ì§€ ì—”ì§„ì´ ì €ì¥í•¨
- í•˜ë“œë””ìŠ¤í¬ ìœ„ì— ìˆëŠ” ì‹¤ì œ ë¬¸ì„œ íŒŒì¼
- **ë°ì´í„°íŒŒì¼(Datafile)**ì€

  ë””ìŠ¤í¬ ìœ„ì— ì¡´ì¬í•˜ëŠ” **OS íŒŒì¼(ì €ì¥ ëŒ€ìƒ)** ì´ê³ ,

  **DBMSì™€ OSì˜ ì§ì ‘ì ì¸ ì†Œí†µì€ â€œë²„í¼í’€ì˜ ì½ê¸°Â·ì“°ê¸° ìš”ì²­â€ í˜•íƒœë¡œ ì¼ì–´ë‚˜ë©°**,

  ê·¸ ê²°ê³¼ê°€ **OSë¥¼ í†µí•´ ë””ìŠ¤í¬ì˜ ë°ì´í„°íŒŒì¼ì— ê¸°ë¡ëœë‹¤.**

  ì¦‰,

  > DBMS â†” OS ê°„ì˜ â€œí†µì‹  ì±„ë„â€ì€ ì‹œìŠ¤í…œ ì½œ(read/write/pwrite) ì´ê³ ,
  >
  >
  > ê·¸ â€œëª©ì ì§€(Target)â€ê°€ **Datafileì´ë¼ëŠ” ë””ìŠ¤í¬ íŒŒì¼**ì„
>

### **Tablespace** : ì„¸ê·¸ë¨¼íŠ¸ë¥¼ ë‹´ëŠ” (ë…¼ë¦¬ì ) ì»¨í…Œì´ë„ˆ

- ì—¬ëŸ¬ ì„¸ê·¸ë¨¼íŠ¸ë¥¼ ë¬¶ëŠ” ë…¼ë¦¬ì  ì €ì¥ ê³µê°„ ë‹¨ìœ„ì„
- í•˜ë‚˜ ì´ìƒì˜ Datafile í¬í•¨
- í…Œì´ë¸”, ì¸ë±ìŠ¤ ë“± ë‹¤ì–‘í•œ ê°ì²´ë“¤ì„ ë¬¶ì–´ì„œ ê´€ë¦¬í•˜ê¸° ìœ„í•¨

### **Segment** : ë°ì´í„° ì €ì¥ê³µê°„ì´ í•„ìš”í•œ ì˜¤ë¸Œì íŠ¸(ì‹¤ì œ â€˜ê°ì²´â€™ì˜ ì €ì¥ ë‹¨ìœ„)

- í…Œì´ë¸”, ì¸ë±ìŠ¤, íŒŒí‹°ì…˜, LOB ë“±

### **Extent** : ë¸”ë¡ ë¬¶ìŒ (**ì—°ì†ëœ** ë¸”ë¡ ì§‘í•©)

### **Block (Page)** : I/Oì˜ ìµœì†Œ ë‹¨ìœ„ë¡œ, ë°ì´í„°ë¥¼ ì½ê³  ì“°ëŠ” ë‹¨ìœ„

# [I/O]

- **ë¸”ë¡ ë‹¨ìœ„ I/O**
    - í´ë¼ìš°ë“œì— ìˆëŠ” íŒŒì¼? â†’ íŒŒì¼ ë‹¨ìœ„ I/O
    - ë°ì´í„°ë² ì´ìŠ¤ì˜ ë°ì´í„°? â†’ ë¸”ë¡ ë‹¨ìœ„ I/O

## **ìˆœì°¨ ì ‘ê·¼ vs ëœë¤ ì ‘ê·¼**

![image](./images/HDD.png)

![image](./images/Sequential_Random_IO.png)

### **ìˆœì°¨ ì ‘ê·¼**

1. ì¸ë±ìŠ¤ ë¸”ë¡
    1. ì¸ë±ìŠ¤ ë¸”ë¡ì˜ ë¦¬í”„ ë¸”ë¡ì€ ì•ë’¤ë¥¼ ê°€ë¦¬í‚¤ëŠ” ì£¼ì†Œê°’ì„ í†µí•´ ì„œë¡œ ë…¼ë¦¬ì ìœ¼ë¡œ ì—°ê²°ë˜ì–´ ìˆìŒ
    2. ì´ ì£¼ì†Œ ê°’ì— ë”°ë¼ ì• ë˜ëŠ” ë’¤ë¡œ ìˆœì°¨ì ìœ¼ë¡œ ìŠ¤ìº”í•˜ëŠ” ë°©ì‹ì´ ìˆœì°¨ ì ‘ê·¼ì„
2. í…Œì´ë¸” ë¸”ë¡
    1. í…Œì´ë¸” ë¸”ë¡ ê°„ì—ëŠ” ì„œë¡œ ë…¼ë¦¬ì ì¸ ì—°ê²°ê³ ë¦¬ë¥¼ ê°–ê³  ìˆì§€ ì•ŠìŒ
    2. ì„¸ê·¸ë¨¼íŠ¸ì— í• ë‹¹ëœ ìµìŠ¤í…íŠ¸ ëª©ë¡ì„ ì„¸ê·¸ë¨¼íŠ¸ í—¤ë”ì— ë§µ(Map)ìœ¼ë¡œ ê´€ë¦¬í•¨
    3. ìµìŠ¤í…íŠ¸ ë§µì€ ê° ìµìŠ¤í…íŠ¸ì˜ ì²« ë²ˆì§¸ ì£¼ì†Œ ê°’ì„ ê°–ê³ , ê° ìµìŠ¤í…íŠ¸ì˜ ì²« ë²ˆì§¸ ë¸”ë¡ ë’¤ì— ì—°ì†í•´ì„œ ì €ì¥ëœ ë¸”ë¡ì„ ìˆœì„œëŒ€ë¡œ ì½ìœ¼ë©´ ê·¸ê²ƒì´ ê³§ Table Full Scanì„

### **ëœë¤ ì ‘ê·¼**

1. ë…¼ë¦¬ì , ë¬¼ë¦¬ì ì¸ ìˆœì„œë¥¼ ë”°ë¥´ì§€ ì•Šê³ , ë ˆì½”ë“œ í•˜ë‚˜ë¥¼ ì½ê¸° ìœ„í•´ í•œ ë¸”ë¡ì”© ì ‘ê·¼í•˜ëŠ” ë°©ì‹
2. ì¸ë±ìŠ¤ ë¸”ë¡ ë¦¬í”„ë¥¼ í†µí•´ í…Œì´ë¸” ë¸”ë¡ì— ì ‘ê·¼í•  ë•Œ, ëœë¤ìœ¼ë¡œ ì ‘ê·¼í•˜ê²Œ ë¨

## **ë…¼ë¦¬ì  I/O vs ë¬¼ë¦¬ì  I/O**

![image](./images/Logical_Physical_IO.png)

- DB ë²„í¼ ìºì‹œ : â€˜ë°ì´í„° ìºì‹œâ€™ (ë””ìŠ¤í¬ì—ì„œ ì½ì€ ë°ì´í„° ë¸”ë¡ì„ ìºì‹±)
- Library ìºì‹œ : â€˜ì½”ë“œ ìºì‹œâ€™ (SQL, ì‹¤í–‰ê³„íš, í”„ë¡œì‹œì € ë“± ìºì‹±)
- **ë…¼ë¦¬ì  I/O**
    - SQL ë¬¸ì„ ì²˜ë¦¬í•˜ëŠ” ê³¼ì •ì—ì„œ ë©”ëª¨ë¦¬ ë²„í¼ ìºì‹œì—ì„œ ë°œìƒí•œ ì´ ë¸”ë¡ I/O
        - Direct Path I/Oê°€ ì‘ë™í•˜ëŠ” ê²½ìš°ê°€ ìˆìœ¼ë¯€ë¡œ ë…¼ë¦¬ì  I/Oì™€ ë©”ëª¨ë¦¬ I/Oê°€ ì •í™•íˆ ê°™ì€ ì˜ë¯¸ëŠ” ì•„ë‹ˆì§€ë§Œ, ì¼ë°˜ì ìœ¼ë¡œ ê°™ë‹¤ê³  ë´ë„ ë¨
            - **DIrect Path I/O**

              **: ë²„í¼ ìºì‹œë¥¼ ìš°íšŒí•˜ê³  ë””ìŠ¤í¬ì™€ PGA ì‚¬ì´ì—ì„œ ì§ì ‘ I/Oë¥¼ ìˆ˜í–‰í•˜ëŠ” ë°©ì‹**

              **[ì¼ë°˜ I/O]**
              PGA â†” Buffer Cache (SGA) â†” Disk

              **[Direct Path I/O]**
              PGA â†” Disk (Buffer Cache ìš°íšŒ!)
                
              ---

              ### ì™œ Direct Path I/Oë¥¼ ì‚¬ìš©í•˜ëŠ”ê°€?

              **ë¬¸ì œ ìƒí™©: ëŒ€ëŸ‰ ë°ì´í„° ì²˜ë¦¬**

                - *í…Œì´ë¸” Full Scan*

              **ì¼ë°˜ I/O ë°©ì‹ì˜ ë¬¸ì œ:**

                1. ë””ìŠ¤í¬ì—ì„œ ë¸”ë¡ ì½ê¸°
                2. Buffer Cacheì— ì ì¬ (ìˆ˜ë°±ë§Œ ê°œ ë¸”ë¡)
                3. Buffer Cacheê°€ ê°€ë“ ì°¸
                4. ê¸°ì¡´ ë¸”ë¡ë“¤ì„ LRUë¡œ ì œê±° (ë‹¤ë¥¸ ì¿¼ë¦¬ê°€ ì‚¬ìš© ì¤‘ì¸ ë¸”ë¡ë„!)
                5. Buffer Cache ì˜¤ì—¼ (Cache Pollution)

              **Direct Path I/Oë¡œ í•´ê²°:**

                1. ë””ìŠ¤í¬ì—ì„œ ë¸”ë¡ ì½ê¸°
                2. Buffer Cache ìš°íšŒ, PGAë¡œ ì§ì ‘ ì „ì†¡
                3. ì²˜ë¦¬ í›„ ë¸”ë¡ ë²„ë¦¼
                4. Buffer Cache ì˜¤ì—¼ ì—†ìŒ!

        - SQLì„ ìˆ˜í–‰í•˜ë©´ì„œ ì½ì€ ì´ ë¸”ë¡ I/Oê°€ ë…¼ë¦¬ì  I/O
            - Direct Path Read ë°©ì‹ ì œì™¸í•˜ë©´ ëª¨ë“  ë¸”ë¡ì€ DB ë²„í¼ ìºì‹œë¥¼ ê²½ìœ í•´ì„œ ì½ìŒ
- **ë¬¼ë¦¬ì  I/O**
    - ë””ìŠ¤í¬ì—ì„œ ë°œìƒí•œ ì´ ë¸”ë¡ I/O
        - SQL ì²˜ë¦¬ ë„ì¤‘ ì½ì–´ì•¼ í•  ë¸”ë¡ì„ ë²„í¼ìºì‹œì—ì„œ ì°¾ì§€ ëª»í•  ë•Œë§Œ ë””ìŠ¤í¬ì— ì ‘ê·¼í•˜ë¯€ë¡œ, ë…¼ë¦¬ì  ë¸”ë¡ I/O ì¤‘ ì¼ë¶€ë¥¼ ë¬¼ë¦¬ì ìœ¼ë¡œ I/Oí•¨
        - DB ë²„í¼ìºì‹œì—ì„œ ë¸”ë¡ì„ ì°¾ì§€ ëª»í•´ ë””ìŠ¤í¬ì—ì„œ ì½ì€ ë¸”ë¡ I/Oê°€ ë¬¼ë¦¬ì  I/O
- **SQL íŠœë‹**
    - **ë…¼ë¦¬ì  I/O(I/O ìì²´)ë¥¼ ì¤„ì´ëŠ” ê²ƒì´ ê³§ SQL íŠœë‹! : I/O ìˆ˜ í˜¹ì€ í¬ê¸°ë¥¼ ì¤„ì´ê¸°**
        - ë¬¼ë¦¬ì  I/OëŠ” í†µì œ ë¶ˆê°€ëŠ¥í•œ ë³€ìˆ˜ë¡œ, ë©”ëª¨ë¦¬ë¥¼ ì¦ì„¤í•˜ì—¬ ë²„í¼ìºì‹œ í¬ê¸°ë¥¼ ëŠ˜ë¦¬ëŠ” ë°©ë²• ì™¸ì—ëŠ” ì§ì ‘ ì¤„ì¼ ë°©ë²•ì´ ì—†ìŒ
        - ë…¼ë¦¬ì  I/Oë¥¼ ì¤„ì´ëŠ” ê±´ SQLì„ íŠœë‹í•´ì„œ ì½ëŠ” ì´ ë¸”ë¡ ê°œìˆ˜ë¥¼ ì¤„ì´ë©´ ë¨
            - ì¶”ê°€ë¡œ ë©”ëª¨ë¦¬ ê³µìœ  ìì›(ìºì‹œ)ì—ì„œ ì§ë ¬í™” ë§¤ì»¤ë‹ˆì¦˜ì„ ìœ„í•œ ë˜ì¹˜(Latch)ì™€ Lock ê²½í•©ìœ¼ë¡œ ì¸í•´ ì§€ì—°ì´ ë°œìƒí•˜ê¸°ë„ í•˜ë¯€ë¡œ, ì—­ì‹œë‚˜ ë…¼ë¦¬ì  I/Oë¥¼ ì¤„ì´ëŠ” ê²ƒë„ í•„ìš”í•¨!!
        - ì´ê²ƒì´ ìŠ¤í„°ë””ì—ì„œ í•  ê²ƒ

## **Single Block I/O vs Multiblock I/O**

- Diskì—ì„œ ë°ì´í„°ë¥¼ ì½ì–´ì˜¬ ë•, ìºì‹œì—ì„œ ë°ì´í„°ë¥¼ ì½ì–´ì˜´
  ìºì‹œì—ì„œ ì°¾ì§€ ëª»í•œ ë°ì´í„°ëŠ” í•´ë‹¹ ë¸”ë¡ì„ ë””ìŠ¤í¬ì—ì„œ ì½ê³ , ìºì‹œì— ì ì¬í•˜ê³ , ì´ë¥¼ ìœ„í•´ I/O Call í•¨
  í•˜ì§€ë§Œ, ë©”ëª¨ë¦¬ì—ëŠ” í•œê³„ê°€ ìˆê¸° ë•Œë¬¸ì— ë°ì´í„°ë¥¼ ëª¨ë‘ ìºì‹œì— ì ì¬í•  ìˆ˜ ì—†ìŒ

### **Single Block I/O** : í•œ ë²ˆì˜ I/O Callë¡œ í•œ ë¸”ë¡ì”© ì½ëŠ” ë°©ì‹

- ì¸ë±ìŠ¤ë¥¼ ì´ìš©í•  ë•ŒëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì¸ë±ìŠ¤ì™€ í…Œì´ë¸” ë¸”ë¡ ëª¨ë‘ Single Block I/O ë°©ì‹ì„ ì‚¬ìš©í•¨ / ì†ŒëŸ‰ ë°ì´í„°ë¥¼ ì½ì„ ë•Œ ì¢‹ìŒ
    - ì¸ë±ìŠ¤ ë£¨íŠ¸ ë¸”ë¡ì„ ì½ì„ ë•Œ
      ì¸ë±ìŠ¤ ë£¨íŠ¸ ë¸”ë¡ì—ì„œ ì–»ì€ ì£¼ì†Œ ì •ë³´ë¡œ ë¸Œëœì¹˜ ë¸”ë¡ì„ ì½ì„ ë•Œ
      ì¸ë±ìŠ¤ ë¸Œëœì¹˜ ë¸”ë¡ì—ì„œ ì–»ì€ ì£¼ì†Œ ì •ë³´ë¡œ ë¦¬í”„ ë¸”ë¡ì„ ì½ì„ ë•Œ
      ì¸ë±ìŠ¤ ë¦¬í”„ ë¸”ë¡ì—ì„œ ì–»ì€ ì£¼ì†Œ ì •ë³´ë¡œ í…Œì´ë¸” ë¸”ë¡ì„ ì½ì„ ë•Œ

### **Multiblock I/O** :í•œ ë²ˆì˜ I/O Callë¡œ ì—¬ëŸ¬ ë¸”ë¡ì”© ì½ëŠ” ë°©ì‹

- ì¸ë±ìŠ¤ë¥¼ ì´ìš©í•˜ì§€ ì•Šê³  í…Œì´ë¸” ì „ì²´ë¥¼ ìŠ¤ìº”í•  ë•Œ ì‚¬ìš© ( Index Fast Full Scan )
- ë§ì€ ë°ì´í„° ë¸”ë¡ì„ ì½ì„ ë•ŒëŠ” Multiblock I/O ë°©ì‹ì´ íš¨ìœ¨ì ì„.
  í•µì‹¬ì€ í”„ë¡œì„¸ìŠ¤ê°€ ì ìëŠ” íšŸìˆ˜ë¥¼ ì¤„ì´ëŠ” ê²ƒ
- í•˜ì§€ë§Œ, ìµìŠ¤í…íŠ¸ì˜ ê²½ê³„ë¥¼ ë„˜ì§€ëŠ” ëª» í•¨. ìµìŠ¤í…íŠ¸ëŠ” ì—°ì†ëœ ë¸”ë¡ì˜ ëª¨ì„ì´ì§€ë§Œ, 8ê°œ ë‹¨ìœ„ë¡œ 20ê°œì˜ ë¸”ë¡ì´ ìˆëŠ” ìµìŠ¤í…íŠ¸ë¥¼ ì½ì„ ë•Œ, 3ë²ˆì§¸ì— 4ê°œì˜ ë¸”ë¡ë§Œ ì½ì–´ ë“¤ì¸ë‹¤ëŠ” ëœ»ì„

## ìŠ¤ìº” ë°©ì‹ ë¹„êµë¡œ ì •ë¦¬

### Table Full Scan vs Index Range Scan

- **Table Full Scan**
    - í…Œì´ë¸” ì „ì²´ë¥¼ ìŠ¤ìº”í•´ì„œ ë°ì´í„°ë¥¼ ì½ëŠ” ë°©ì‹
    - ìˆœì°¨ ì ‘ê·¼ + Multiblock I/O ë°©ì‹ìœ¼ë¡œ ë””ìŠ¤í¬ ë¸”ë¡ì„ ì½ìŒ
        - ìºì‹œì—ì„œ ëª» ì°¾ìœ¼ë©´ í•œ ë²ˆì˜ I/O Callì„ í†µí•´ ì¸ì ‘í•œ ìˆ˜ì‹­ ~ ìˆ˜ë°± ê°œ ë¸”ë¡ì„ í•œêº¼ë²ˆì— I/O í•¨
- **Index (Range) Scan**
    - ì¸ë±ìŠ¤ë¥¼ ì´ìš©í•´ì„œ ë°ì´í„°ë¥¼ ì½ëŠ” ë°©ì‹
    - ëœë¤ ì ‘ê·¼ + Single Block I/O ë°©ì‹ìœ¼ë¡œ ë””ìŠ¤í¬ ë¸”ë¡ì„ ì½ìŒ
        - ì™œ ëœë¤? â†’ ì¸ë±ìŠ¤ íƒ€ê³  ë¦¬í”„ ê°€ë„ ê²°êµ­ í…Œì´ë¸” ì ‘ê·¼í•´ì•¼ í•˜ê³ , **ì´ëŠ” â€˜ëœë¤ ì ‘ê·¼â€™ì„**
- Table Full Scanì€ ë§ˆëƒ¥ í”¼í•´ì•¼ë§Œ í•˜ëŠ” ì¡´ì¬ê°€ ì•„ë‹ˆë‹¤
    - í•œ ë²ˆì— ë§ì€ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ëŠ” ì§‘ê³„ìš© SQLê³¼ ë°°ì¹˜ í”„ë¡œê·¸ë¨ ë“±ì€ Table Full Scanì´ ë” íš¨ìœ¨ì ì¼ ìˆ˜ ìˆìŒ

ê·¸ ë‹¤ìŒ ì£¼ ë³µê¸°ìš©ìœ¼ë¡œ ì§ˆë¬¸ë“¤ì— ëŒ€í•œ ë‹µ ìƒê°í•´ì˜¤ê¸°?

ê·¸ë¦¬ê³  ê·¸ê±° ê°™ì´ ì–˜ê¸°í•´ë³´ê³  í•´ë‹¹ ì£¼ì°¨ ìŠ¤í„°ë”” ì‹œì‘?

### ë¬¸ì œ

- **Q. DBMSì—ì„œ ìºì‹±(DB Buffer pool, InnoDB Buffer)ì„ í•´ì£¼ëŠ”ë°, ë ˆë””ìŠ¤ ìºì‹±ì„ ì™œ í•˜ëŠ”ì§€?**

  ### ğŸ’¡ ëª¨ë²” ë‹µì•ˆ

  **í•µì‹¬: ìºì‹± ë ˆë²¨ê³¼ ëª©ì ì´ ë‹¤ë¥´ë‹¤**

  `[DB Buffer Pool]
    - ìœ„ì¹˜: DB ì„œë²„ ë‚´ë¶€ (ë©”ëª¨ë¦¬)
    - ìºì‹± ë‹¨ìœ„: ë¸”ë¡/í˜ì´ì§€ (8KB, 16KB)
    - ëª©ì : ë””ìŠ¤í¬ I/O ìµœì†Œí™”
    - ë²”ìœ„: ë‹¨ì¼ DB ì¸ìŠ¤í„´ìŠ¤

  [Redis Cache]
    - ìœ„ì¹˜: ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ DB ì‚¬ì´ (ë³„ë„ ì„œë²„)
    - ìºì‹± ë‹¨ìœ„: ì• í”Œë¦¬ì¼€ì´ì…˜ ê°ì²´ (JSON, ë¬¸ìì—´)
    - ëª©ì : DB ì ‘ê·¼ ìì²´ë¥¼ ìµœì†Œí™” + ë„¤íŠ¸ì›Œí¬ ì™•ë³µ ê°ì†Œ
    - ë²”ìœ„: ì—¬ëŸ¬ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ê°€ ê³µìœ `

  **êµ¬ì²´ì ì¸ ì°¨ì´:**

    1. **DB ì ‘ê·¼ íšŸìˆ˜**

  java

  `*// Buffer Poolë§Œ ì‚¬ìš© (Redis ì—†ìŒ)*
  SELECT * FROM customer WHERE id = 123;  *// ë„¤íŠ¸ì›Œí¬ ì™•ë³µ 1íšŒ*
  â†’ Buffer Pool Hitì—¬ë„ ì—¬ì „íˆ SQL íŒŒì‹±, ì‹¤í–‰ ê³„íš, DB ì»¤ë„¥ì…˜ í•„ìš”

  *// Redis ì‚¬ìš©*
  String customer = redis.get("customer:123");  *// ë„¤íŠ¸ì›Œí¬ ì™•ë³µ 1íšŒ*
  â†’ DB ì ‘ê·¼ ìì²´ë¥¼ ì•ˆ í•¨! SQL íŒŒì‹±ë„ ì—†ìŒ!
    ```
    
    2. **ì²˜ë¦¬ ì†ë„**
    ```
  Buffer Pool Hit: 0.1~1ms (SQL íŒŒì‹± + ë²„í¼ ìºì‹œ ì¡°íšŒ)
  Redis Hit: 0.01~0.1ms (ë‹¨ìˆœ ë©”ëª¨ë¦¬ ì¡°íšŒ)
  â†’ 10ë°° ì°¨ì´`

    1. **ë³µì¡í•œ ì¿¼ë¦¬ ê²°ê³¼ ìºì‹±**

  sql

    - `*- ë³µì¡í•œ ì§‘ê³„ ì¿¼ë¦¬ (100ms ì†Œìš”)*
      SELECT category, COUNT(*) as count, AVG(price) as avg_price
      FROM products
      WHERE created_at > DATE_SUB(NOW(), INTERVAL 1 DAY)
      GROUP BY category;
      *- Buffer Poolì´ ìˆì–´ë„ ë§¤ë²ˆ 100ms ê±¸ë¦¼- Redisì— ê²°ê³¼ë¥¼ ìºì‹±í•˜ë©´ â†’ 0.01ms*`
    1. **ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨ ë°ì´í„°**

  java

  `*// ì„¸ì…˜, ì¥ë°”êµ¬ë‹ˆ, ì‹¤ì‹œê°„ ë­í‚¹ ë“±// DBì— ì €ì¥í•  í•„ìš” ì—†ëŠ” ì„ì‹œ ë°ì´í„°*
  redis.setex("cart:user123", 3600, cartData);`

  **ê²°ë¡ :** Buffer Poolì€ "ë¸”ë¡ ë ˆë²¨ ìºì‹œ", RedisëŠ” "ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨ ìºì‹œ"

- **Q. PreparedStatementë¥¼ ì‚¬ìš©í•˜ë©´ í•­ìƒ ì„±ëŠ¥ì´ ì¢‹ì„ê¹Œ? ì˜¤íˆë ¤ ëŠë¦° ê²½ìš°ë„ ìˆì§€ ì•Šì„ê¹Œ?**

  ### 2ï¸âƒ£ PreparedStatementë¥¼ ì‚¬ìš©í•˜ë©´ í•­ìƒ ì„±ëŠ¥ì´ ì¢‹ì„ê¹Œ? ì˜¤íˆë ¤ ëŠë¦° ê²½ìš°ë„ ìˆì§€ ì•Šì„ê¹Œ?

  ### ğŸ’¡ ëª¨ë²” ë‹µì•ˆ

  **í•µì‹¬: ì‹¤í–‰ íšŸìˆ˜ì™€ ì¿¼ë¦¬ íŒ¨í„´ì— ë”°ë¼ ë‹¤ë¥´ë‹¤**

  ### âŒ PreparedStatementê°€ ëŠë¦° ê²½ìš°

  **1. ë‹¨ 1íšŒë§Œ ì‹¤í–‰í•˜ëŠ” ì¿¼ë¦¬ (ì„œë²„ ì‚¬ì´ë“œ)**

  java

  `*// useServerPrepStmts=trueì¸ ê²½ìš°*
  PreparedStatement pstmt = conn.prepareStatement(sql);  *// ë„¤íŠ¸ì›Œí¬ ì™•ë³µ 1íšŒ (PREPARE)*
  pstmt.setInt(1, 123);
  pstmt.executeQuery();  *// ë„¤íŠ¸ì›Œí¬ ì™•ë³µ 2íšŒ (EXECUTE)// ì´: 2íšŒ ì™•ë³µ// Statement*
  Statement stmt = conn.createStatement();
  stmt.executeQuery(sql);  *// ë„¤íŠ¸ì›Œí¬ ì™•ë³µ 1íšŒ// ì´: 1íšŒ ì™•ë³µ*

  â†’ PreparedStatementê°€ ë” ëŠë¦¼!`

  **2. í†µê³„ ì •ë³´ê°€ ë¶€ì •í™•í•´ì§€ëŠ” ê²½ìš°**

  sql

    - `*- ë°ì´í„° ë¶„í¬ê°€ ì‹¬í•˜ê²Œ ë¶ˆê· ë“±í•œ ì»¬ëŸ¼*
      SELECT * FROM orders WHERE status = ?;
      *- status ë¶„í¬:- 'completed': 1,000,000ê±´ (99%)- 'pending': 10,000ê±´ (1%)*
    ```
    ```
  PreparedStatement:
    - ì²« ì‹¤í–‰: status='completed' â†’ Full Scan ê³„íš ìƒì„±
    - ì´í›„ ì‹¤í–‰: status='pending'ì¸ë°ë„ Full Scan ì‚¬ìš©! â†’ ì¸ë±ìŠ¤ê°€ ìœ ë¦¬í•œë°ë„ Full Scan
      Statement:
    - ë§¤ë²ˆ ìµœì í™” â†’ ê°’ì— ë”°ë¼ ë‹¤ë¥¸ ì‹¤í–‰ ê³„íš
    - 'pending'ì¼ ë•ŒëŠ” ì¸ë±ìŠ¤ ì‚¬ìš©`

  **3. IN ì ˆì˜ ê°œìˆ˜ê°€ ê°€ë³€ì ì¸ ê²½ìš°**

  java

  `*// ìƒí’ˆ ID ê°œìˆ˜ê°€ ë§¤ë²ˆ ë‹¤ë¦„*
  String sql = "SELECT * FROM products WHERE id IN (?, ?, ?)";  *// 3ê°œ*
  PreparedStatement pstmt = conn.prepareStatement(sql);

  *// ë‹¤ìŒì— 5ê°œ í•„ìš” â†’ ë‹¤ì‹œ prepare í•„ìš”*
  sql = "SELECT * FROM products WHERE id IN (?, ?, ?, ?, ?)";  *// 5ê°œ*`

  ### âœ… PreparedStatementê°€ ìœ ë¦¬í•œ ê²½ìš°

  **1. ê°™ì€ ì¿¼ë¦¬ë¥¼ ë°˜ë³µ ì‹¤í–‰ (10íšŒ ì´ìƒ)**

  java

  `PreparedStatement pstmt = conn.prepareStatement(
  "INSERT INTO logs VALUES (?, ?, ?)"
  );

  for (int i = 0; i < 10000; i++) {
  pstmt.setInt(1, i);
  pstmt.setString(2, "action");
  pstmt.setTimestamp(3, now);
  pstmt.addBatch();
  }
  pstmt.executeBatch();

  *// Prepare 1íšŒ + Execute 10,000íšŒ// Statementì˜€ë‹¤ë©´ íŒŒì‹± 10,000íšŒ!*`

  **ê²°ë¡ :**

    - ë°˜ë³µ ì‹¤í–‰: PreparedStatement âœ…
    - ë‹¨ë°œ ì‹¤í–‰: Statementê°€ ë‚˜ì„ ìˆ˜ë„ ìˆìŒ
    - í•˜ì§€ë§Œ **SQL Injection ë°©ì–´** ë•Œë¬¸ì— PreparedStatement ê¶Œì¥!
- **Q. ì¸ë±ìŠ¤ë¥¼ íƒ€ëŠ”ë°ë„ ì¿¼ë¦¬ê°€ ëŠë¦¬ë‹¤ë©´ ì–´ë–¤ ê²½ìš°ë“¤ì´ ìˆì„ê¹Œ? (ì´ê±´ ì¸ë±ìŠ¤ ë‹¨ì›ì—ì„œ)**

  ### ğŸ’¡ ëª¨ë²” ë‹µì•ˆ

  **í•µì‹¬: ì¸ë±ìŠ¤ë¥¼ "íƒ€ê¸´ íƒ€ëŠ”ë°" ë¹„íš¨ìœ¨ì ìœ¼ë¡œ íƒ€ëŠ” ê²½ìš°**

  ### 1. **ì¸ë±ìŠ¤ë¥¼ íƒ”ì§€ë§Œ ìŠ¤ìº” ë²”ìœ„ê°€ ë„ˆë¬´ ë„“ì€ ê²½ìš°**

  sql

    - `*- ì¸ë±ìŠ¤: (status, created_at)*
      SELECT * FROM orders
      WHERE status = 'completed' *- 100ë§Œ ê±´* AND created_at > '2024-01-01';
      *- ì‹¤í–‰ ê³„íš:*
      Index Range Scan (status)
      â†’ 100ë§Œ ê±´ì˜ ì¸ë±ìŠ¤ ë¦¬í”„ ë¸”ë¡ ìŠ¤ìº”
      â†’ 100ë§Œ ë²ˆì˜ í…Œì´ë¸” ëœë¤ ì•¡ì„¸ìŠ¤
      â†’ ëŠë¦¼!
      *- ê°œì„ : ì¸ë±ìŠ¤ ì»¬ëŸ¼ ìˆœì„œ ë³€ê²½*
      ì¸ë±ìŠ¤: (created_at, status)
      â†’ ìµœê·¼ ë°ì´í„°ë§Œ ìŠ¤ìº” (10ë§Œ ê±´)`

  ### 2. **ì»¤ë²„ë§ ì¸ë±ìŠ¤ê°€ ì•„ë‹Œ ê²½ìš° (í…Œì´ë¸” ëœë¤ ì•¡ì„¸ìŠ¤)**

  sql

    - `*- ì¸ë±ìŠ¤: (login_id)*
      SELECT * FROM customer WHERE login_id = 'user123';
      *- ì‹¤í–‰ ê³¼ì •:*
    1. ì¸ë±ìŠ¤ ìŠ¤ìº” (Single Block I/O Ã— 3)
    2. í…Œì´ë¸” ì ‘ê·¼ (Single Block I/O Ã— 1) â† ì—¬ê¸°ê°€ ë¬¸ì œ!
       *- 1ê±´ì´ë©´ ê´œì°®ì§€ë§Œ, 100ê±´ì´ë©´?*
       â†’ ì¸ë±ìŠ¤ ìŠ¤ìº” 300ë¸”ë¡ + í…Œì´ë¸” ì•¡ì„¸ìŠ¤ 100ë¸”ë¡ = 400 I/O`

  **ê°œì„ :**

  sql

    - `*- ì»¤ë²„ë§ ì¸ë±ìŠ¤ ìƒì„±*
      CREATE INDEX idx_covering ON customer(login_id, name, email);
      SELECT login_id, name, email *- * ëŒ€ì‹  í•„ìš”í•œ ì»¬ëŸ¼ë§Œ*
      FROM customer
      WHERE login_id = 'user123';
      *- í…Œì´ë¸” ì ‘ê·¼ ì—†ì´ ì¸ë±ìŠ¤ë§Œìœ¼ë¡œ í•´ê²°!*`

  ### 3. **ì¸ë±ìŠ¤ ìŠ¤ìº” í›„ í•„í„°ë§ì´ ë§ì€ ê²½ìš°**

  sql

    - `*- ì¸ë±ìŠ¤: (created_at)*
      SELECT * FROM orders
      WHERE created_at > '2024-01-01' *- ì¸ë±ìŠ¤ ì¡°ê±´* AND status = 'completed' *- í•„í„° ì¡°ê±´* AND amount > 10000; *- í•„í„° ì¡°ê±´- ì‹¤í–‰ ê³„íš:*
      Index Range Scan (created_at) â† ì¸ë±ìŠ¤ íƒ€ê¸´ íƒ
      â†’ 100ë§Œ ê±´ ì½ìŒ
      â†’ í•„í„° ì¡°ê±´ìœ¼ë¡œ ê±¸ëŸ¬ì§ (ìµœì¢… 1000ê±´)
      â†’ 99.9%ê°€ ë²„ë ¤ì§!`

  **ê°œì„ :**

  sql

    - `*- ë³µí•© ì¸ë±ìŠ¤*
      CREATE INDEX idx_multi ON orders(status, created_at, amount);`

  ### 4. **ì¸ë±ìŠ¤ ì»¬ëŸ¼ì„ ê°€ê³µí•œ ê²½ìš°**

  sql

    - `*- ì¸ë±ìŠ¤: (created_at)*
      SELECT * FROM orders
      WHERE YEAR(created_at) = 2024; *- âŒ ì¸ë±ìŠ¤ ëª» íƒ!- í•¨ìˆ˜ ì‚¬ìš©ìœ¼ë¡œ ì¸ë±ìŠ¤ ë¬´ìš©ì§€ë¬¼- ê°œì„ *
      WHERE created_at >= '2024-01-01' AND created_at < '2025-01-01'; *- âœ… ì¸ë±ìŠ¤ ì‚¬ìš©*`

  ### 5. **ë°ì´í„° íƒ€ì… ë¶ˆì¼ì¹˜**

  sql

    - `*- ì»¬ëŸ¼: id INT, ì¸ë±ìŠ¤ ìˆìŒ*
      SELECT * FROM customer WHERE id = '123'; *- ë¬¸ìì—´ë¡œ ì¡°íšŒ- ì•”ë¬µì  í˜•ë³€í™˜ ë°œìƒ â†’ ì¸ë±ìŠ¤ ëª» íƒ!- ê°œì„ *
      WHERE id = 123; *- ìˆ«ìë¡œ*
    ```
    **ê²°ë¡ :** ì¸ë±ìŠ¤ë¥¼ íƒ„ë‹¤ê³  ë¬´ì¡°ê±´ ë¹ ë¥¸ ê²Œ ì•„ë‹ˆë¼, **ì–¼ë§ˆë‚˜ íš¨ìœ¨ì ìœ¼ë¡œ íƒ€ëŠ”ì§€**ê°€ ì¤‘ìš”!`